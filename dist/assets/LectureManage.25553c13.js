var ne=(e,c,f)=>new Promise((b,D)=>{var E=d=>{try{h(f.next(d))}catch(g){D(g)}},m=d=>{try{h(f.throw(d))}catch(g){D(g)}},h=d=>d.done?b(d.value):Promise.resolve(d.value).then(E,m);h((f=f.apply(e,c)).next())});import{N as Ie,a as De,Q as o,o as I,j as T,z as u,v as p,bE as _,dF as Ce,n as t,B as V,x as Y,y as q,h as te,U as ae,H as ue,l as ye,bI as Se,bJ as Ae,i as Z,t as Te,K as we}from"./index.c77972c6.js";import{B as Le}from"./TableImg.565e2cfb.js";import"./componentMap.e56f5f78.js";import{u as oe}from"./useTable.b1caf103.js";import{P as Me}from"./index.36f96364.js";import{u as G}from"./index.52c66243.js";import Ne from"./AddLectureModal.4b70ca5c.js";import{d as ie}from"./courseApi.f0bcd249.js";import Ue from"./SignInResult.05397aa4.js";/* empty css                *//* empty css              *//* empty css                */import"./BasicForm.1cb0e446.js";/* empty css               *//* empty css               */import"./FormItem.vue_vue_type_script_lang.60aa0b9b.js";/* empty css               */import"./uniqBy.0d6271bc.js";import"./useForm.5f123e01.js";import"./RadioButtonGroup.29ec0324.js";import"./useFormItem.0ca96f1f.js";/* empty css                *//* empty css                *//* empty css               *//* empty css                */import"./uuid.2b29000c.js";import"./useWindowSizeFn.3455cf29.js";import"./sortable.esm.c20789c1.js";import"./RedoOutlined.b9aeb074.js";import"./FullscreenOutlined.dcdca408.js";/* empty css                *//* empty css                *//* empty css                *//* empty css                *//* empty css                *//* empty css                *//* empty css                */import"./download.8a8ffec6.js";import"./base64Conver.08b9f4ec.js";import"./index.90918534.js";import"./index.c85ba8d6.js";/* empty css               *//* empty css                */import"./useContentViewHeight.06cda917.js";import"./useECharts.f2181bf2.js";let le=null,v=-1,O=-1,se=[],w=180,X=!1,K=0;const Re=De({components:{BasicTable:Le,PageWrapper:Me,AddLectureModal:Ne,SignInResult:Ue},setup(){const e=p(""),c=[{account:"U202220012",class:"\u7535\u4FE12201\u73ED",email:"chaofeng@example.net",id:39,index:1,klass_id:3,name:"\u9648\u7389",tel:"13114161530"},{account:"U202220013",class:"\u7535\u4FE12201\u73ED",email:"wei82@example.net",id:40,index:2,klass_id:3,name:"\u9B4F\u96EA\u6885",tel:"18612937066"},{account:"U202220014",class:"\u7535\u4FE12201\u73ED",email:"leili@example.org",id:41,index:3,klass_id:3,name:"\u80E1\u6D69",tel:"15798628437"},{account:"U202220015",class:"\u7535\u4FE12201\u73ED",email:"xiuying52@example.com",id:42,index:4,klass_id:3,name:"\u8881\u8273",tel:"15213723899"},{account:"U202220016",class:"\u7535\u4FE12201\u73ED",email:"jxia@example.org",id:43,index:5,klass_id:3,name:"\u5415\u4FCA",tel:"13772252084"},{account:"U202220017",class:"\u7535\u4FE12201\u73ED",email:"junren@example.net",id:44,index:6,klass_id:3,name:"\u5E9E\u6842\u8363",tel:"15090477990"},{account:"U202220018",class:"\u7535\u4FE12201\u73ED",email:"chao01@example.com",id:45,index:7,klass_id:3,name:"\u738B\u4E3D\u5A1F",tel:"13969487739"},{account:"U202220019",class:"\u7535\u4FE12201\u73ED",email:"eyu@example.com",id:46,index:8,klass_id:3,name:"\u859B\u4E3D",tel:"14552460572"},{account:"U202220020",class:"\u7535\u4FE12201\u73ED",email:"ggong@example.com",id:47,index:9,klass_id:3,name:"\u9A6C\u83B9",tel:"13110849959"},{account:"U202220021",class:"\u7535\u4FE12201\u73ED",email:"vye@example.org",id:48,index:10,klass_id:3,name:"\u90B1\u6210",tel:"14506536740"},{account:"U202220022",class:"\u7535\u4FE12201\u73ED",email:"fangna@example.com",id:49,index:11,klass_id:3,name:"\u5F90\u6842\u82B3",tel:"18182687221"},{account:"U202220023",class:"\u7535\u4FE12201\u73ED",email:"nyao@example.com",id:50,index:12,klass_id:3,name:"\u5218\u79C0\u82F1",tel:"18856630789"},{account:"U202220025",class:"\u7535\u4FE12201\u73ED",email:"ufeng@example.net",id:52,index:13,klass_id:3,name:"\u5B8B\u7389",tel:"13229827769"}],f=p([]),b=p(!1),D=p(!1),E=p({uList:[],sList:[],signNum:0,totalNum:0,timeDuration:["",""]}),m=p([]),h=p([]),d=p(3);let g=[];const C=p(0),k=p(!1);_.post({url:"/lecture/list",params:null}).then(n=>{f.value=[],n.forEach(a=>{f.value.push({label:a.name+"("+a.klass+")",value:a.id})}),le=n});let B,F=[];const[P,{openModal:L}]=G(),[M,{openModal:x}]=G(),[N,{openModal:S}]=G(),[z,{reload:A,getSelectRows:$,setTableData:j}]=oe({columns:[{title:"\u5B66\u751F\u540D\u79F0",dataIndex:"name"},{title:"\u5B66\u751F\u5B66\u53F7",dataIndex:"account"}],pagination:{pageSize:10}}),[H,{setTableData:U}]=oe({columns:[{title:"\u5B66\u751F\u59D3\u540D",dataIndex:"name"},{title:"\u8BFE\u7A0B\u5206\u6570",dataIndex:"score",edit:!0,editRule:n=>ne(this,null,function*(){if(isNaN(n))return"\u8BF7\u8F93\u5165\u6709\u6548\u5206\u6570";try{const a=parseInt(n);if(a>100||a<0)return"\u8BF7\u8F93\u5165\u6709\u6548\u5206\u6570"}catch(a){return"\u8BF7\u8F93\u5165\u6709\u6548\u5206\u6570"}return""}),width:200}],pagination:{pageSize:10}});function W(){v!=-1&&(k.value=!0)}function J(){de(d.value),k.value=!1}function Q(n){n!=3||v==-1||X||_.get({url:"/score/list",params:{lecture_id:v}}).then(a=>{F=[],a.forEach(l=>{F.push({name:l.name,id:l.id,score:l.score===null?"\u6682\u672A\u8BC4\u5206":l.score.toString()})}),U(F),X=!0}).catch(a=>{})}function i(n,a){v=n;let l="";le.forEach(s=>{s.id==n&&(l=s.klass)}),_.get({url:"/score/list",params:{lecture_id:v}}).then(s=>{F=[],s.forEach(r=>{F.push({name:r.name,id:r.id,score:r.score===null?"\u6682\u672A\u8BC4\u5206":r.score.toString()})}),U(F),X=!0}).catch(s=>{}),_.get({url:"/signIn/prev",params:{lec_id:v}}).then(s=>{m.value=[],s.forEach(r=>{let y={signNum:r.signed_num,uList:r.unsigned_students,totalNum:r.total_num,timeDuration:[],sList:[]};y.sList=r.signed_students.map(ke=>ke.name);const R=new Date(parseInt(r.end_time)).toLocaleTimeString(),be=new Date(parseInt(r.start_time)).toLocaleString();y.timeDuration=[be,R],m.value.push(y)})}).catch(s=>{}),_.post({url:"/student/list",params:{class:l}}).then(s=>{se=s,setTimeout(()=>{},100),j(se)}).catch(s=>{})}function re(n){}function de(n){clearInterval(B),w=n*60,K=0,_.post({url:"/signIn/add",params:{lec_id:v,end_time:new Date().getTime()+w*1e3,start_time:new Date().getTime()}}).then(a=>{O=a}).catch(a=>{}),b.value=!0,B=setInterval(()=>{K++,C.value=K/w*100,_.get({url:"/signIn/getInfo",params:{id:O}}).then(a=>{a.ended||(g=[],h.value=[],a.data.forEach(l=>{h.value.push({name:l.name,time:new Date(parseInt(l.signin_time)).toLocaleTimeString()})})),w<=K&&(clearInterval(B),b.value=!1,_.get({url:"/signIn/end",params:{signin_id:O}}).then(l=>{ee(l)}))})},1e3)}function ce({record:n,index:a,key:l,value:s}){return!1}function me(){setTimeout(()=>{A()},200)}function ge({record:n,index:a,key:l,value:s}){const{createMessage:r}=we();return r.loading({content:"\u6B63\u5728\u66F4\u65B0\u6210\u7EE9",key:"_save_fake_data",duration:0}),new Promise(y=>{_.post({url:"/score/edit",params:{score:n.score,lecture_id:v,student_id:F[a].id}}).then(R=>{r.success({content:"\u6210\u529F\u66F4\u65B0"+n.name+"\u6210\u7EE9",key:"_save_fake_data",duration:2}),y(!0)}).catch(R=>{r.error({content:"\u4FDD\u5B58\u5931\u8D25:"+R.toString(),key:"_save_fake_data",duration:2}),y(!1)})})}function pe(){}function _e(n){const a=(1-n/100)*w,l=parseInt(a/60).toString(),s=parseInt(a%60).toString();return(l.length==1?"0":"")+l+":"+(s.length==1?"0":"")+s}function fe(){$().forEach(a=>{const l={id:a.id};ie(l)}),setTimeout(()=>{A()},200)}function Ee(n){Se.confirm({title:()=>"\u786E\u5B9A\u5220\u9664\u8BFE\u7A0B\u5417\uFF1F",icon:()=>t(Ae),content:()=>"\u5220\u9664\u8BFE\u7A0B\u540D\u79F0\uFF1A"+n.name,okText:()=>"Yes",okType:"danger",cancelText:()=>"No",onOk(){const a={id:n.id};ie(a),setTimeout(()=>{A()},200)},onCancel(){}})}Ce(()=>{clearInterval(B)});function ee(n,a){e.value="1",E.value.signNum=n.data.signed_num,E.value.totalNum=n.data.total_num,E.value.sList=n.data.signed_students.map(r=>r.name);const l=typeof a=="undefined"?new Date(parseInt(n.data.end_time)).toLocaleTimeString():new Date(a).toLocaleTimeString(),s=new Date(parseInt(n.data.start_time)).toLocaleString();E.value.timeDuration=[s,l],E.value.uList=n.data.unsigned_students,D.value=!0}function he(){clearInterval(B),b.value=!1,_.get({url:"/signIn/end",params:{signin_id:O}}).then(n=>{ee(n,new Date().getTime())})}function Fe(n){S(!0,n)}function Be(n){}function ve(){L(!0)}return{defaultPercent:C,prevSignIns:m,value:d,signInInfo:E,signin_data:g,stu_data_i:c,showTimeRemaining:_e,selectFirst:re,registerTable:z,endSigningIn:he,showSignInModal:W,addCourse:ve,register4:M,edit_register:N,handleEditEnd:ce,handleEditCancel:pe,beforeEditSubmit:ge,openModalLM:L,options:f,handleOk:J,registerLM:P,handleEdit:Fe,openEditModal:S,handleDelete:Ee,openModal4:x,registerScoreTable:H,handleChange:i,deleteSelected:fe,handleVisibleChange:me,test:Be,data:h,handleTabChange:Q,visible:k,isSigningIn:b,signInFinished:D,activeKey:e,key:0}}}),Ve=Z("span",null," \xA0\xA0\u7B7E\u5230\u5F00\u542F\u65F6\u957F\uFF1A",-1),Oe=Z("span",null,"\u5206\u949F",-1);function Ke(e,c,f,b,D,E){const m=o("a-space"),h=o("a-select"),d=o("BasicTable"),g=o("a-tab-pane"),C=o("a-button"),k=o("a-row"),B=o("a-divider"),F=o("a-progress"),P=o("a-input-number"),L=o("a-modal"),M=o("a-card"),x=o("a-col"),N=o("SignInResult"),S=o("a-collapse-panel"),z=o("a-collapse"),A=o("a-list-item"),$=o("a-list"),j=o("a-tabs"),H=o("a-page-header"),U=o("AddLectureModal"),W=o("AddCourseModal"),J=o("EditCourseModal"),Q=o("PageWrapper");return I(),T(Q,{contentBackground:"",contentClass:"flex",dense:"",contentFullHeight:""},{default:u(()=>[t(H,{title:"\u8BFE\u7A0B\u6559\u5B66\u7BA1\u7406",subtitle:""},{extra:u(()=>[t(m,null,{default:u(()=>[V("\u8BF7\u9009\u62E9\u8BFE\u7A0B:")]),_:1}),t(m,null,{default:u(()=>[t(h,{ref:"select",value:e.label,"onUpdate:value":c[0]||(c[0]=i=>e.label=i),style:{width:"240px"},options:e.options,defaultOpen:!0,onChange:e.handleChange},null,8,["value","options","onChange"])]),_:1})]),footer:u(()=>[t(j,{style:{width:"1250px"},onChange:e.handleTabChange},{default:u(()=>[t(g,{key:"1",tab:"\u8BFE\u7A0B\u5B66\u751F\u5217\u8868"},{default:u(()=>[t(d,{rowKey:"account",onRegister:e.registerTable,dataSource:e.stu_data,immediate:!1},null,8,["onRegister","dataSource"])]),_:1}),t(g,{key:"2",tab:"\u8BFE\u7A0B\u7B7E\u5230\u7BA1\u7406"},{default:u(()=>[t(k,null,{default:u(()=>[t(m,null,{default:u(()=>[t(C,{type:"primary",disabled:e.isSigningIn,onClick:e.showSignInModal},{default:u(()=>[V("\u5F00\u542F\u7B7E\u5230")]),_:1},8,["disabled","onClick"]),Y(t(C,{danger:"",onClick:e.endSigningIn},{default:u(()=>[V("\u63D0\u524D\u7ED3\u675F\u7B7E\u5230")]),_:1},8,["onClick"]),[[q,e.isSigningIn]])]),_:1})]),_:1}),t(B),t(k,null,{default:u(()=>[Y(t(F,{type:"circle",align:e.center,percent:e.defaultPercent,format:e.showTimeRemaining},null,8,["align","percent","format"]),[[q,e.isSigningIn]])]),_:1}),t(L,{visible:e.visible,"onUpdate:visible":c[2]||(c[2]=i=>e.visible=i),title:"\u5F00\u542F\u7B7E\u5230",onOk:e.handleOk},{default:u(()=>[t(m,null,{default:u(()=>[Ve,(I(),T(P,{id:"inputNumber",value:e.value,"onUpdate:value":c[1]||(c[1]=i=>e.value=i),key:e.key,defaultValue:10,size:20,min:1,max:60},null,8,["value"])),Oe]),_:1})]),_:1},8,["visible","onOk"]),t(m),Y(t(k,{gutter:16},{default:u(()=>[(I(!0),te(ue,null,ae(e.data,i=>(I(),T(x,{span:2.5,key:i.name},{default:u(()=>[t(M,{style:{"background-color":"#52c41a","border-radius":"12px"},title:i.name,bordered:!0},{default:u(()=>[Z("p",null,Te(i.time),1)]),_:2},1032,["title"])]),_:2},1032,["span"]))),128))]),_:1},512),[[q,e.isSigningIn]]),t(z,{activeKey:e.activeKey,"onUpdate:activeKey":c[3]||(c[3]=i=>e.activeKey=i)},{default:u(()=>[t(S,{key:"1",header:"\u672C\u6B21\u7B7E\u5230\u7ED3\u679C",disabled:!e.signInFinished},{default:u(()=>[e.signInFinished?(I(),T(N,{key:0,"signed-num":e.signInInfo.signNum,"total-num":e.signInInfo.totalNum,"signed-list":e.signInInfo.sList,"unsigned-list":e.signInInfo.uList,"time-duration":e.signInInfo.timeDuration},null,8,["signed-num","total-num","signed-list","unsigned-list","time-duration"])):ye("",!0)]),_:1},8,["disabled"]),t(S,{key:"2",header:"\u5386\u53F2\u7B7E\u5230\u8BB0\u5F55"},{default:u(()=>[(I(!0),te(ue,null,ae(e.prevSignIns,i=>(I(),T(N,{key:i.id,"signed-num":i.signNum,"total-num":i.totalNum,"signed-list":i.sList,"unsigned-list":i.uList,"time-duration":i.timeDuration},null,8,["signed-num","total-num","signed-list","unsigned-list","time-duration"]))),128))]),_:1})]),_:1},8,["activeKey"])]),_:1}),t(g,{key:"3",tab:"\u8BFE\u7A0B\u5206\u6570\u7BA1\u7406"},{default:u(()=>[t(d,{onRegister:e.registerScoreTable,onEditEnd:e.handleEditEnd,onEditCancel:e.handleEditCancel,beforeEditSubmit:e.beforeEditSubmit,immediate:!1},null,8,["onRegister","onEditEnd","onEditCancel","beforeEditSubmit"])]),_:1}),t(g,{key:"4",tab:"\u968F\u673A\u9009\u4EBA"},{default:u(()=>[t(C,{type:"primary",disabled:e.isSigningIn,onClick:e.showSignInModal},{default:u(()=>[V("\u968F\u673A\u62BD\u9009\u5B66\u751F")]),_:1},8,["disabled","onClick"]),t(B),t($,{grid:{gutter:16,column:10},"data-source":e.stu_data_i},{renderItem:u(({item:i})=>[t(A,null,{default:u(()=>[t(M,{title:i.name},null,8,["title"])]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1},8,["onChange"])]),_:1}),t(U,{onRegister:e.registerLM},null,8,["onRegister"]),t(W,{onRegister:e.register4,onOk:e.test,onVisibleChange:e.handleVisibleChange},null,8,["onRegister","onOk","onVisibleChange"]),t(J,{onRegister:e.edit_register,onOk:e.test,onVisibleChange:e.handleVisibleChange},null,8,["onRegister","onOk","onVisibleChange"])]),_:1})}var Mn=Ie(Re,[["render",Ke]]);export{Mn as default};
